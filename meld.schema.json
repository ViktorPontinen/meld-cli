{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "meld.jsonc",
  "description": "Configuration for the meld agent settings generator",
  "type": "object",
  "required": ["projects", "agents", "mcp", "ide"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference (auto-generated by meld)"
    },
    "projects": {
      "type": "object",
      "description": "Registered projects in this workspace",
      "additionalProperties": {
        "type": "object",
        "required": ["path", "aliases"],
        "properties": {
          "path": { "type": "string", "description": "Absolute or ~-relative path to the project" },
          "aliases": { "type": "array", "items": { "type": "string" }, "description": "Natural language names for the project" },
          "repo": { "type": "string", "description": "GitHub repository (org/repo, optional)" }
        }
      }
    },
    "agents": {
      "type": "object",
      "description": "Agent configurations â€” enable/disable and set overrides per agent",
      "required": ["claude-code", "codex-cli", "gemini-cli"],
      "properties": {
        "claude-code": { "$ref": "#/definitions/claudeCodeConfig" },
        "codex-cli": { "$ref": "#/definitions/codexCliConfig" },
        "gemini-cli": { "$ref": "#/definitions/geminiCliConfig" }
      },
      "additionalProperties": false
    },
    "mcp": {
      "type": "object",
      "description": "MCP server configurations",
      "additionalProperties": {
        "oneOf": [
          { "$ref": "#/definitions/mcpStdioServer" },
          { "$ref": "#/definitions/mcpHttpServer" }
        ]
      }
    },
    "context": {
      "type": "string",
      "description": "Path to context directory containing .md files. Default: ./context/",
      "default": "./context/"
    },
    "ide": {
      "type": "object",
      "required": ["default", "workspaceName"],
      "properties": {
        "default": { "type": "string", "enum": ["cursor", "code", "windsurf"] },
        "workspaceName": { "type": "string" }
      }
    }
  },
  "definitions": {
    "agentName": {
      "type": "string",
      "enum": ["claude-code", "codex-cli", "gemini-cli"]
    },
    "agentConfigBase": {
      "type": "object",
      "required": ["enabled"],
      "properties": {
        "enabled": { "type": "boolean", "description": "Enable config generation for this agent" },
        "dir": { "type": "string", "description": "Custom subdirectory name for this agent's generated files (defaults to agent-specific name)" }
      }
    },
    "claudeCodeConfig": {
      "allOf": [
        { "$ref": "#/definitions/agentConfigBase" },
        {
          "properties": {
            "enabled": true,
            "dir": true,
            "overrides": {
              "description": "Overrides deep-merged into .claude/settings.json",
              "$ref": "https://json.schemastore.org/claude-code-settings.json"
            }
          }
        }
      ]
    },
    "codexCliConfig": {
      "allOf": [
        { "$ref": "#/definitions/agentConfigBase" },
        {
          "properties": {
            "enabled": true,
            "dir": true,
            "overrides": {
              "description": "Overrides deep-merged into .codex/config.toml",
              "$ref": "https://developers.openai.com/codex/config-schema.json"
            }
          }
        }
      ]
    },
    "geminiCliConfig": {
      "allOf": [
        { "$ref": "#/definitions/agentConfigBase" },
        {
          "properties": {
            "enabled": true,
            "dir": true,
            "overrides": {
              "description": "Overrides deep-merged into .gemini/settings.json",
              "$ref": "https://raw.githubusercontent.com/google-gemini/gemini-cli/refs/heads/main/schemas/settings.schema.json"
            }
          }
        }
      ]
    },
    "mcpStdioServer": {
      "type": "object",
      "required": ["command", "args"],
      "properties": {
        "type": { "type": "string", "enum": ["stdio"], "description": "Server type (default: stdio)" },
        "command": { "type": "string", "description": "Command to start the server" },
        "args": { "type": "array", "items": { "type": "string" }, "description": "Command arguments" },
        "env": { "type": "object", "additionalProperties": { "type": "string" }, "description": "Environment variables" },
        "agents": { "type": "array", "items": { "$ref": "#/definitions/agentName" }, "description": "Scope this server to specific agents (defaults to all enabled)" }
      }
    },
    "mcpHttpServer": {
      "type": "object",
      "required": ["type", "url"],
      "properties": {
        "type": { "type": "string", "enum": ["http"], "description": "Server type" },
        "url": { "type": "string", "description": "MCP server URL" },
        "headers": { "type": "object", "additionalProperties": { "type": "string" }, "description": "HTTP headers (e.g. Authorization)" },
        "env": { "type": "object", "additionalProperties": { "type": "string" }, "description": "Environment variables" },
        "agents": { "type": "array", "items": { "$ref": "#/definitions/agentName" }, "description": "Scope this server to specific agents (defaults to all enabled)" }
      }
    }
  }
}
